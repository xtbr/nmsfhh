<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞—Å—á–µ—Ç–Ω–∏–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ–ª–∏–≥—Ä–∞—Ñ–∏–∏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div id="authScreen" class="min-h-screen flex items-center justify-center px-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">üñ®Ô∏è –ü–æ–ª–∏–≥—Ä–∞—Ñ–∏—è</h1>
                <p class="text-gray-600">–°–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤</p>
            </div>

            <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
            <div id="loginForm">
                <h2 class="text-xl font-semibold text-gray-800 mb-6">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
                <form id="loginFormElement" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–õ–æ–≥–∏–Ω</label>
                        <input type="text" id="loginUsername" required 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="loginPassword" required 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                    </div>
                    <button type="submit" 
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                        –í–æ–π—Ç–∏
                    </button>
                </form>
                <p class="text-center mt-4 text-sm text-gray-600">
                    –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? 
                    <button id="showRegister" class="text-blue-600 hover:text-blue-700 font-medium">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                </p>
            </div>

            <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
            <div id="registerForm" class="hidden">
                <h2 class="text-xl font-semibold text-gray-800 mb-6">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                <form id="registerFormElement" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–ò–º—è</label>
                        <input type="text" id="registerName" required 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="–í–∞—à–µ –∏–º—è">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–õ–æ–≥–∏–Ω</label>
                        <input type="text" id="registerUsername" required 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="registerPassword" required 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
                    </div>
                    <button type="submit" 
                            class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                        –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                    </button>
                </form>
                <p class="text-center mt-4 text-sm text-gray-600">
                    –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? 
                    <button id="showLogin" class="text-blue-600 hover:text-blue-700 font-medium">–í–æ–π—Ç–∏</button>
                </p>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div id="mainApp" class="hidden">
        <div class="container mx-auto px-4 py-8 max-w-7xl">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –≤—ã—Ö–æ–¥–æ–º -->
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h1 class="text-4xl font-bold text-gray-800 mb-2">üìä –†–∞—Å—á–µ—Ç–Ω–∏–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤</h1>
                    <p class="text-gray-600">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="userName"></span>!</p>
                </div>
                <button id="logoutBtn" 
                        class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                    üö™ –í—ã–π—Ç–∏
                </button>
            </div>

            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <div class="flex flex-wrap items-center justify-between gap-4">
                    <div class="flex items-center space-x-4">
                        <h3 class="text-lg font-semibold text-gray-800">üìÖ –ü–µ—Ä–∏–æ–¥:</h3>
                        <select id="periodSelect" 
                                class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="today">–°–µ–≥–æ–¥–Ω—è</option>
                            <option value="month">–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</option>
                            <option value="custom-day">–í—ã–±—Ä–∞—Ç—å –¥–µ–Ω—å</option>
                            <option value="custom-month">–í—ã–±—Ä–∞—Ç—å –º–µ—Å—è—Ü</option>
                        </select>
                        <input type="date" id="customDate" class="hidden px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <input type="month" id="customMonth" class="hidden px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div class="text-sm text-gray-600" id="currentPeriod"></div>
                </div>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
                    <div class="flex items-center">
                        <div class="text-3xl mr-4">üë•</div>
                        <div>
                            <p class="text-sm text-gray-600">–ö–ª–∏–µ–Ω—Ç–æ–≤</p>
                            <p class="text-2xl font-bold text-gray-800" id="totalClients">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500">
                    <div class="flex items-center">
                        <div class="text-3xl mr-4">üí∞</div>
                        <div>
                            <p class="text-sm text-gray-600">–í—ã—Ä—É—á–∫–∞</p>
                            <p class="text-2xl font-bold text-gray-800" id="totalRevenue">0 ‚ÇΩ</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500">
                    <div class="flex items-center">
                        <div class="text-3xl mr-4">üìà</div>
                        <div>
                            <p class="text-sm text-gray-600">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</p>
                            <p class="text-2xl font-bold text-gray-800" id="averageCheck">0 ‚ÇΩ</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-orange-500">
                    <div class="flex items-center">
                        <div class="text-3xl mr-4">üèÜ</div>
                        <div>
                            <p class="text-sm text-gray-600">–õ—É—á—à–∏–π –¥–µ–Ω—å</p>
                            <p class="text-lg font-bold text-gray-800" id="bestDay">-</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                        <span class="text-2xl mr-3">‚ûï</span>
                        –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
                    </h2>
                    
                    <form id="clientForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞</label>
                            <input type="text" id="clientName" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                   placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">–£—Å–ª—É–≥–∞</label>
                            <select id="serviceType" required 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É</option>
                                <option value="–ü–µ—á–∞—Ç—å –≤–∏–∑–∏—Ç–æ–∫">–ü–µ—á–∞—Ç—å –≤–∏–∑–∏—Ç–æ–∫</option>
                                <option value="–ü–µ—á–∞—Ç—å –ª–∏—Å—Ç–æ–≤–æ–∫">–ü–µ—á–∞—Ç—å –ª–∏—Å—Ç–æ–≤–æ–∫</option>
                                <option value="–ü–µ—á–∞—Ç—å –±–∞–Ω–Ω–µ—Ä–æ–≤">–ü–µ—á–∞—Ç—å –±–∞–Ω–Ω–µ—Ä–æ–≤</option>
                                <option value="–ü–µ—á–∞—Ç—å –±—É–∫–ª–µ—Ç–æ–≤">–ü–µ—á–∞—Ç—å –±—É–∫–ª–µ—Ç–æ–≤</option>
                                <option value="–ü–µ—á–∞—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–π">–ü–µ—á–∞—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–π</option>
                                <option value="–ü–µ—á–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤">–ü–µ—á–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</option>
                                <option value="–û—Ç–∫—Ä—ã–≤–∞–Ω–∏–µ —Ç—É–Ω–¥—É–∫–∞">–û—Ç–∫—Ä—ã–≤–∞–Ω–∏–µ —Ç—É–Ω–¥—É–∫–∞</option>
                                <option value="–õ–∞–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ">–õ–∞–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</option>
                                <option value="–ü–µ—Ä–µ–ø–ª–µ—Ç">–ü–µ—Ä–µ–ø–ª–µ—Ç</option>
                                <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">–°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞ (‚ÇΩ)</label>
                            <input type="number" id="paymentAmount" required min="0" step="0.01"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                   placeholder="0.00">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">–î–∞—Ç–∞</label>
                            <input type="date" id="paymentDate" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        </div>
                        
                        <button type="submit" 
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 flex items-center justify-center">
                            <span class="mr-2">üíæ</span>
                            –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
                        </button>
                    </form>
                </div>

                <!-- –°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800 flex items-center">
                            <span class="text-2xl mr-3">üìã</span>
                            –°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤
                        </h2>
                        <div class="flex space-x-2">
                            <button id="exportData" 
                                    class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                üìä –≠–∫—Å–ø–æ—Ä—Ç
                            </button>
                            <button id="clearPeriod" 
                                    class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
                            </button>
                        </div>
                    </div>
                    
                    <div id="clientsList" class="space-y-3 max-h-96 overflow-y-auto">
                        <div class="text-center text-gray-500 py-8">
                            <div class="text-4xl mb-2">üìù</div>
                            <p>–ö–ª–∏–µ–Ω—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
            <div class="bg-white rounded-xl shadow-lg p-6 mt-8">
                <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    <span class="text-xl mr-3">üîç</span>
                    –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏</label>
                        <input type="text" id="searchName" 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –¥–ª—è –ø–æ–∏—Å–∫–∞">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–§–∏–ª—å—Ç—Ä –ø–æ —É—Å–ª—É–≥–µ</label>
                        <select id="filterService" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">–í—Å–µ —É—Å–ª—É–≥–∏</option>
                            <option value="–ü–µ—á–∞—Ç—å –≤–∏–∑–∏—Ç–æ–∫">–ü–µ—á–∞—Ç—å –≤–∏–∑–∏—Ç–æ–∫</option>
                            <option value="–ü–µ—á–∞—Ç—å –ª–∏—Å—Ç–æ–≤–æ–∫">–ü–µ—á–∞—Ç—å –ª–∏—Å—Ç–æ–≤–æ–∫</option>
                            <option value="–ü–µ—á–∞—Ç—å –±–∞–Ω–Ω–µ—Ä–æ–≤">–ü–µ—á–∞—Ç—å –±–∞–Ω–Ω–µ—Ä–æ–≤</option>
                            <option value="–ü–µ—á–∞—Ç—å –±—É–∫–ª–µ—Ç–æ–≤">–ü–µ—á–∞—Ç—å –±—É–∫–ª–µ—Ç–æ–≤</option>
                            <option value="–ü–µ—á–∞—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–π">–ü–µ—á–∞—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–π</option>
                            <option value="–ü–µ—á–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤">–ü–µ—á–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</option>
                            <option value="–û—Ç–∫—Ä—ã–≤–∞–Ω–∏–µ —Ç—É–Ω–¥—É–∫–∞">–û—Ç–∫—Ä—ã–≤–∞–Ω–∏–µ —Ç—É–Ω–¥—É–∫–∞</option>
                            <option value="–õ–∞–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ">–õ–∞–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</option>
                            <option value="–ü–µ—Ä–µ–ø–ª–µ—Ç">–ü–µ—Ä–µ–ø–ª–µ—Ç</option>
                            <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
                        <select id="sortBy" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="date-desc">–ü–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ –ø–µ—Ä–≤—ã–µ)</option>
                            <option value="date-asc">–ü–æ –¥–∞—Ç–µ (—Å—Ç–∞—Ä—ã–µ –ø–µ—Ä–≤—ã–µ)</option>
                            <option value="amount-desc">–ü–æ —Å—É–º–º–µ (–±–æ–ª—å—à–µ –ø–µ—Ä–≤—ã–µ)</option>
                            <option value="amount-asc">–ü–æ —Å—É–º–º–µ (–º–µ–Ω—å—à–µ –ø–µ—Ä–≤—ã–µ)</option>
                            <option value="name-asc">–ü–æ –∏–º–µ–Ω–∏ (–ê-–Ø)</option>
                            <option value="name-desc">–ü–æ –∏–º–µ–Ω–∏ (–Ø-–ê)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º (–¥–ª—è –º–µ—Å—è—á–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞) -->
            <div id="dailyStats" class="bg-white rounded-xl shadow-lg p-6 mt-8 hidden">
                <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    <span class="text-xl mr-3">üìä</span>
                    –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º
                </h3>
                <div id="dailyStatsContent" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let clients = [];
        let currentPeriod = 'today';
        let customDate = null;
        let customMonth = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É localStorage
            if (typeof(Storage) === "undefined") {
                showNotification('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç localStorage', 'error');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å localStorage
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                console.log('localStorage –¥–æ—Å—Ç—É–ø–µ–Ω');
            } catch (error) {
                console.error('localStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', error);
                showNotification('–ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –≤ –±—Ä–∞—É–∑–µ—Ä–µ', 'error');
            }
            
            checkAuth();
            setupEventListeners();
            document.getElementById('paymentDate').valueAsDate = new Date();
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function checkAuth() {
            try {
                const savedUser = localStorage.getItem('polygraphy-current-user');
                if (savedUser) {
                    try {
                        currentUser = JSON.parse(savedUser);
                        if (currentUser && currentUser.id && currentUser.name) {
                            console.log('–ù–∞–π–¥–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', currentUser.name);
                            showMainApp();
                            return;
                        } else {
                            console.log('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ—á–∏—â–∞–µ–º');
                            localStorage.removeItem('polygraphy-current-user');
                        }
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                        localStorage.removeItem('polygraphy-current-user');
                    }
                }
                
                console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞');
                showAuthScreen();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
                showAuthScreen();
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function showAuthScreen() {
            document.getElementById('authScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        function showMainApp() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('userName').textContent = currentUser.name;
            loadClients();
            updateDisplay();
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
            document.getElementById('showRegister').addEventListener('click', () => {
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('registerForm').classList.remove('hidden');
            });

            document.getElementById('showLogin').addEventListener('click', () => {
                document.getElementById('registerForm').classList.add('hidden');
                document.getElementById('loginForm').classList.remove('hidden');
            });

            document.getElementById('loginFormElement').addEventListener('submit', handleLogin);
            document.getElementById('registerFormElement').addEventListener('submit', handleRegister);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);

            // –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            document.getElementById('clientForm').addEventListener('submit', handleAddClient);
            document.getElementById('clearPeriod').addEventListener('click', handleClearPeriod);
            document.getElementById('exportData').addEventListener('click', handleExportData);

            // –§–∏–ª—å—Ç—Ä—ã
            document.getElementById('searchName').addEventListener('input', updateDisplay);
            document.getElementById('filterService').addEventListener('change', updateDisplay);
            document.getElementById('sortBy').addEventListener('change', updateDisplay);

            // –ü–µ—Ä–∏–æ–¥
            document.getElementById('periodSelect').addEventListener('change', handlePeriodChange);
            document.getElementById('customDate').addEventListener('change', handleCustomDateChange);
            document.getElementById('customMonth').addEventListener('change', handleCustomMonthChange);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥–∞
        function handleLogin(e) {
            e.preventDefault();
            
            try {
                const username = document.getElementById('loginUsername').value.trim();
                const password = document.getElementById('loginPassword').value.trim();

                if (!username || !password) {
                    showNotification('–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å', 'error');
                    return;
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å localStorage
                if (typeof(Storage) === "undefined") {
                    showNotification('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö', 'error');
                    return;
                }

                let users = [];
                try {
                    users = JSON.parse(localStorage.getItem('polygraphy-users') || '[]');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
                    users = [];
                }

                console.log('–ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞:', username);
                console.log('–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:', users.length);
                
                // –ò—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                let user = users.find(u => u.username && u.password && 
                    u.username.trim().toLowerCase() === username.toLowerCase() && 
                    u.password.trim() === password);

                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                if (!user && username.toLowerCase() === 'admin' && password === 'admin') {
                    const testUser = {
                        id: Date.now(),
                        name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                        username: 'admin',
                        password: 'admin',
                        createdAt: new Date().toISOString()
                    };
                    
                    users.push(testUser);
                    try {
                        localStorage.setItem('polygraphy-users', JSON.stringify(users));
                        user = testUser;
                        console.log('–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä');
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                        showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 'error');
                        return;
                    }
                }

                if (user) {
                    try {
                        currentUser = user;
                        localStorage.setItem('polygraphy-current-user', JSON.stringify(user));
                        
                        // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                        document.getElementById('loginUsername').value = '';
                        document.getElementById('loginPassword').value = '';
                        
                        showMainApp();
                        showNotification(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${user.name}!`, 'success');
                        console.log('–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', user.name);
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ:', error);
                        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                    }
                } else {
                    showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å. –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: admin/admin', 'error');
                    console.log('–ù–µ—É–¥–∞—á–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è:', username);
                }
            } catch (error) {
                console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ:', error);
                showNotification('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.', 'error');
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function handleRegister(e) {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;

            const users = JSON.parse(localStorage.getItem('polygraphy-users') || '[]');
            
            if (users.find(u => u.username === username)) {
                showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 'error');
                return;
            }

            const newUser = {
                id: Date.now(),
                name,
                username,
                password,
                createdAt: new Date().toISOString()
            };

            users.push(newUser);
            localStorage.setItem('polygraphy-users', JSON.stringify(users));
            
            currentUser = newUser;
            localStorage.setItem('polygraphy-current-user', JSON.stringify(newUser));
            
            showMainApp();
            showNotification('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!', 'success');
        }

        // –í—ã—Ö–æ–¥
        function handleLogout() {
            // –°–æ–∑–¥–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-sm mx-4">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–∞</h3>
                    <p class="text-gray-600 mb-6">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã?</p>
                    <div class="flex space-x-3">
                        <button class="confirm-logout-btn flex-1 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            –í—ã–π—Ç–∏
                        </button>
                        <button class="cancel-logout-btn flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-lg font-medium transition-colors">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª–∞—Å—Å—ã –≤–º–µ—Å—Ç–æ ID –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
            modal.querySelector('.confirm-logout-btn').addEventListener('click', () => {
                try {
                    localStorage.removeItem('polygraphy-current-user');
                    currentUser = null;
                    clients = [];
                    
                    // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º
                    document.getElementById('loginUsername').value = '';
                    document.getElementById('loginPassword').value = '';
                    document.getElementById('registerName').value = '';
                    document.getElementById('registerUsername').value = '';
                    document.getElementById('registerPassword').value = '';
                    
                    // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞
                    document.getElementById('registerForm').classList.add('hidden');
                    document.getElementById('loginForm').classList.remove('hidden');
                    
                    document.body.removeChild(modal);
                    showAuthScreen();
                    showNotification('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'info');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ:', error);
                    document.body.removeChild(modal);
                    showNotification('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ', 'error');
                }
            });
            
            modal.querySelector('.cancel-logout-btn').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
        function loadClients() {
            if (!currentUser || !currentUser.id) {
                console.error('–ù–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                clients = [];
                return;
            }

            try {
                const key = `polygraphy-clients-${currentUser.id}`;
                const savedData = localStorage.getItem(key);
                console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', currentUser.id, currentUser.name);
                
                if (savedData) {
                    try {
                        clients = JSON.parse(savedData);
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ
                        if (!Array.isArray(clients)) {
                            console.warn('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º');
                            clients = [];
                        }
                    } catch (parseError) {
                        console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤:', parseError);
                        clients = [];
                    }
                } else {
                    clients = [];
                }
                
                console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–≤:', clients.length);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                clients = [];
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
        function saveClients() {
            try {
                const key = `polygraphy-clients-${currentUser.id}`;
                localStorage.setItem(key, JSON.stringify(clients));
                console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–≤:', clients.length, '–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', currentUser.id);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å
                const saved = localStorage.getItem(key);
                if (!saved) {
                    throw new Error('–î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å –≤ localStorage');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö', 'error');
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
        function handleAddClient(e) {
            e.preventDefault();
            
            const clientData = {
                id: Date.now(),
                name: document.getElementById('clientName').value.trim(),
                service: document.getElementById('serviceType').value,
                amount: parseFloat(document.getElementById('paymentAmount').value),
                date: document.getElementById('paymentDate').value,
                userId: currentUser.id,
                createdAt: new Date().toISOString()
            };
            
            console.log('–î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∏–µ–Ω—Ç–∞:', clientData);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
            if (!clientData.name || !clientData.service || !clientData.amount || !clientData.date) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            clients.push(clientData);
            console.log('–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:', clients.length);
            
            saveClients();
            updateDisplay();
            
            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            e.target.reset();
            document.getElementById('paymentDate').valueAsDate = new Date();
            
            showNotification(`–ö–ª–∏–µ–Ω—Ç ${clientData.name} –¥–æ–±–∞–≤–ª–µ–Ω! –í—Å–µ–≥–æ: ${clients.length}`, 'success');
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
        function deleteClient(id) {
            const client = clients.find(c => c.id === id);
            if (!client) return;
            
            // –°–æ–∑–¥–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-sm mx-4">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h3>
                    <p class="text-gray-600 mb-6">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ "${client.name}"?</p>
                    <div class="flex space-x-3">
                        <button id="confirmDelete" class="flex-1 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            –£–¥–∞–ª–∏—Ç—å
                        </button>
                        <button id="cancelDelete" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-lg font-medium transition-colors">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('confirmDelete').addEventListener('click', () => {
                clients = clients.filter(client => client.id !== id);
                saveClients();
                updateDisplay();
                document.body.removeChild(modal);
                showNotification('–ö–ª–∏–µ–Ω—Ç —É–¥–∞–ª–µ–Ω', 'info');
            });
            
            document.getElementById('cancelDelete').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
        }

        // –û—á–∏—Å—Ç–∫–∞ –ø–µ—Ä–∏–æ–¥–∞
        function handleClearPeriod() {
            const filteredClients = getFilteredClientsByPeriod();
            if (filteredClients.length === 0) {
                showNotification('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è', 'info');
                return;
            }

            // –°–æ–∑–¥–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-sm mx-4">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—á–∏—Å—Ç–∫–∏</h3>
                    <p class="text-gray-600 mb-6">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥? (${filteredClients.length} –∑–∞–ø–∏—Å–µ–π)</p>
                    <div class="flex space-x-3">
                        <button id="confirmClear" class="flex-1 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            –£–¥–∞–ª–∏—Ç—å
                        </button>
                        <button id="cancelClear" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-lg font-medium transition-colors">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('confirmClear').addEventListener('click', () => {
                const filteredIds = new Set(filteredClients.map(c => c.id));
                clients = clients.filter(client => !filteredIds.has(client.id));
                saveClients();
                updateDisplay();
                document.body.removeChild(modal);
                showNotification('–î–∞–Ω–Ω—ã–µ –∑–∞ –ø–µ—Ä–∏–æ–¥ –æ—á–∏—â–µ–Ω—ã', 'info');
            });
            
            document.getElementById('cancelClear').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function handleExportData() {
            const filteredClients = getFilteredClients();
            if (filteredClients.length === 0) {
                showNotification('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'info');
                return;
            }

            const csvContent = generateCSV(filteredClients);
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `clients_${getCurrentPeriodString()}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è CSV
        function generateCSV(data) {
            const headers = ['–î–∞—Ç–∞', '–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞', '–£—Å–ª—É–≥–∞', '–°—É–º–º–∞'];
            const rows = data.map(client => [
                new Date(client.date).toLocaleDateString('ru-RU'),
                client.name,
                client.service,
                client.amount
            ]);
            
            return [headers, ...rows].map(row => row.join(',')).join('\n');
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞
        function handlePeriodChange() {
            const select = document.getElementById('periodSelect');
            currentPeriod = select.value;
            
            document.getElementById('customDate').classList.add('hidden');
            document.getElementById('customMonth').classList.add('hidden');
            
            if (currentPeriod === 'custom-day') {
                document.getElementById('customDate').classList.remove('hidden');
                document.getElementById('customDate').valueAsDate = new Date();
                customDate = document.getElementById('customDate').value;
            } else if (currentPeriod === 'custom-month') {
                document.getElementById('customMonth').classList.remove('hidden');
                const now = new Date();
                document.getElementById('customMonth').value = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
                customMonth = document.getElementById('customMonth').value;
            }
            
            updateDisplay();
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –¥–∞—Ç—ã
        function handleCustomDateChange() {
            customDate = document.getElementById('customDate').value;
            updateDisplay();
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –º–µ—Å—è—Ü–∞
        function handleCustomMonthChange() {
            customMonth = document.getElementById('customMonth').value;
            updateDisplay();
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
        function getCurrentPeriodString() {
            const now = new Date();
            switch (currentPeriod) {
                case 'today':
                    return now.toLocaleDateString('ru-RU');
                case 'month':
                    return `${now.toLocaleDateString('ru-RU', { month: 'long', year: 'numeric' })}`;
                case 'custom-day':
                    return customDate ? new Date(customDate).toLocaleDateString('ru-RU') : '';
                case 'custom-month':
                    return customMonth ? new Date(customMonth + '-01').toLocaleDateString('ru-RU', { month: 'long', year: 'numeric' }) : '';
                default:
                    return '';
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ –ø–µ—Ä–∏–æ–¥—É
        function getFilteredClientsByPeriod() {
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            const currentMonthStart = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-01`;
            const currentMonthEnd = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate()}`;

            return clients.filter(client => {
                switch (currentPeriod) {
                    case 'today':
                        return client.date === today;
                    case 'month':
                        return client.date >= currentMonthStart && client.date <= currentMonthEnd;
                    case 'custom-day':
                        return customDate && client.date === customDate;
                    case 'custom-month':
                        if (!customMonth) return false;
                        const [year, month] = customMonth.split('-');
                        const monthStart = `${year}-${month}-01`;
                        const monthEnd = `${year}-${month}-${new Date(year, month, 0).getDate()}`;
                        return client.date >= monthStart && client.date <= monthEnd;
                    default:
                        return true;
                }
            });
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
        function getFilteredClients() {
            let filtered = getFilteredClientsByPeriod();
            
            // –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏
            const searchName = document.getElementById('searchName').value.toLowerCase();
            if (searchName) {
                filtered = filtered.filter(client => 
                    client.name.toLowerCase().includes(searchName)
                );
            }
            
            // –§–∏–ª—å—Ç—Ä –ø–æ —É—Å–ª—É–≥–µ
            const filterService = document.getElementById('filterService').value;
            if (filterService) {
                filtered = filtered.filter(client => client.service === filterService);
            }
            
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
            const sortBy = document.getElementById('sortBy').value;
            filtered.sort((a, b) => {
                switch (sortBy) {
                    case 'date-desc':
                        return new Date(b.date) - new Date(a.date);
                    case 'date-asc':
                        return new Date(a.date) - new Date(b.date);
                    case 'amount-desc':
                        return b.amount - a.amount;
                    case 'amount-asc':
                        return a.amount - b.amount;
                    case 'name-asc':
                        return a.name.localeCompare(b.name, 'ru');
                    case 'name-desc':
                        return b.name.localeCompare(a.name, 'ru');
                    default:
                        return 0;
                }
            });
            
            return filtered;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function updateDisplay() {
            updateStats();
            displayClients();
            updatePeriodInfo();
            updateDailyStats();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–µ—Ä–∏–æ–¥–µ
        function updatePeriodInfo() {
            document.getElementById('currentPeriod').textContent = `–ü–æ–∫–∞–∑–∞–Ω–æ: ${getCurrentPeriodString()}`;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            const filteredClients = getFilteredClientsByPeriod();
            const totalClients = filteredClients.length;
            const totalRevenue = filteredClients.reduce((sum, client) => sum + client.amount, 0);
            const averageCheck = totalClients > 0 ? totalRevenue / totalClients : 0;

            document.getElementById('totalClients').textContent = totalClients;
            document.getElementById('totalRevenue').textContent = totalRevenue.toLocaleString('ru-RU') + ' ‚ÇΩ';
            document.getElementById('averageCheck').textContent = averageCheck.toLocaleString('ru-RU') + ' ‚ÇΩ';

            // –õ—É—á—à–∏–π –¥–µ–Ω—å
            const bestDay = getBestDay();
            document.getElementById('bestDay').textContent = bestDay;
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ª—É—á—à–µ–≥–æ –¥–Ω—è
        function getBestDay() {
            const dailyTotals = {};
            const filteredClients = getFilteredClientsByPeriod();
            
            filteredClients.forEach(client => {
                const date = client.date;
                dailyTotals[date] = (dailyTotals[date] || 0) + client.amount;
            });

            let bestDate = null;
            let bestAmount = 0;
            
            for (const [date, amount] of Object.entries(dailyTotals)) {
                if (amount > bestAmount) {
                    bestAmount = amount;
                    bestDate = date;
                }
            }

            return bestDate ? new Date(bestDate).toLocaleDateString('ru-RU') : '-';
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
        function displayClients() {
            const container = document.getElementById('clientsList');
            let filteredClients = getFilteredClients();

            if (filteredClients.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <div class="text-4xl mb-2">üìù</div>
                        <p>–ö–ª–∏–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredClients.map(client => `
                <div class="bg-gray-50 rounded-lg p-4 border border-gray-200 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center mb-2">
                                <span class="text-lg mr-2">üë§</span>
                                <h4 class="font-semibold text-gray-800">${client.name}</h4>
                            </div>
                            <div class="text-sm text-gray-600 space-y-1">
                                <div class="flex items-center">
                                    <span class="mr-2">üõ†Ô∏è</span>
                                    <span>${client.service}</span>
                                </div>
                                <div class="flex items-center">
                                    <span class="mr-2">üí∞</span>
                                    <span class="font-medium text-green-600">${client.amount.toLocaleString('ru-RU')} ‚ÇΩ</span>
                                </div>
                                <div class="flex items-center">
                                    <span class="mr-2">üìÖ</span>
                                    <span>${new Date(client.date).toLocaleDateString('ru-RU')}</span>
                                </div>
                            </div>
                        </div>
                        <button data-client-id="${client.id}" class="delete-btn text-red-500 hover:text-red-700 p-2 rounded-lg hover:bg-red-50 transition-colors">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è
            container.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const clientId = parseInt(this.getAttribute('data-client-id'));
                    deleteClient(clientId);
                });
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –¥–Ω—è–º
        function updateDailyStats() {
            const dailyStatsDiv = document.getElementById('dailyStats');
            const dailyStatsContent = document.getElementById('dailyStatsContent');
            
            if (currentPeriod === 'month' || currentPeriod === 'custom-month') {
                dailyStatsDiv.classList.remove('hidden');
                
                const filteredClients = getFilteredClientsByPeriod();
                const dailyTotals = {};
                
                filteredClients.forEach(client => {
                    const date = client.date;
                    if (!dailyTotals[date]) {
                        dailyTotals[date] = { count: 0, amount: 0 };
                    }
                    dailyTotals[date].count++;
                    dailyTotals[date].amount += client.amount;
                });

                const sortedDays = Object.entries(dailyTotals)
                    .sort(([a], [b]) => new Date(b) - new Date(a))
                    .slice(0, 10); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –¥–Ω–µ–π

                dailyStatsContent.innerHTML = sortedDays.map(([date, stats]) => `
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                        <div class="text-sm text-gray-600 mb-1">${new Date(date).toLocaleDateString('ru-RU')}</div>
                        <div class="text-lg font-semibold text-gray-800">${stats.count} –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                        <div class="text-sm text-green-600 font-medium">${stats.amount.toLocaleString('ru-RU')} ‚ÇΩ</div>
                    </div>
                `).join('');
            } else {
                dailyStatsDiv.classList.add('hidden');
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium z-50 transform transition-all duration-300 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96ed5c25e199e4c5',t:'MTc1NTE0MjA4NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
